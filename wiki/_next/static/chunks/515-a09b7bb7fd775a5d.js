"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[515],{8515:(e,t,r)=>{r.d(t,{GrapheDeConnaissance:()=>m});var s=r(4568),o=r(4715),l=r(3076),i=r(8079),a=r(285),n=r(2250),d=r(9664),c=r.n(d),p=r(7620),g=r(6179),h=r(5276),u=r(1290),b=r(509);let f={Vedettes:"#3b82f6",Lieu:"#10b981",Événement:"#f59e0b",Concepts:"#8b5cf6",Defaut:"#000000"},x={noeudArticle:function(e){let{data:t}=e,r=f[t.categorie]||f.Defaut,o=t.estCentre?"border-4 border-yellow-600":"border-2 border-gray-700",l=t.estCentre?75:50,i="??";if(t.titre){let e=t.titre.split(" ");if(1===e.length)i=e[0].substring(0,4).toUpperCase();else{i="";for(let t=0;t<e.length&&t<4;t++)0===e[t].length?(e.splice(t,1),t--):i+=e[t].charAt(0).toUpperCase()}}return(0,s.jsxs)("div",{className:"group relative",children:[(0,s.jsx)(g.h7,{type:"source",position:g.yX.Top,style:{opacity:0,top:"50%",left:"50%"}}),(0,s.jsx)(g.h7,{type:"target",position:g.yX.Top,style:{opacity:0,top:"50%",left:"50%"}}),(0,s.jsx)(c(),{href:"/article/".concat(t.slug),className:"".concat(o," rounded-full flex items-center justify-center transition-all duration-200 cursor-pointer hover:scale-110 hover:shadow-lg bg-gray-800"),style:{width:l,height:l},children:(0,s.jsx)("div",{className:"w-full h-full rounded-full flex items-center justify-center text-white font-bold text-xs",style:{backgroundColor:r},children:i})}),(0,s.jsxs)("div",{className:"absolute hidden group-hover:flex flex-col items-center -top-16 left-1/2 -translate-x-1/2 z-50 pointer-events-none",children:[(0,s.jsxs)("div",{className:"bg-gray-900 text-white px-3 py-2 rounded-lg shadow-xl whitespace-nowrap border border-gray-700",children:[(0,s.jsx)("p",{className:"font-bold text-sm",children:t.titre}),(0,s.jsx)("p",{className:"text-xs text-gray-400",children:t.categorie})]}),(0,s.jsx)("div",{className:"w-0 h-0 border-l-8 border-r-8 border-t-8 border-transparent border-t-gray-900"})]})]})}},y={areteArticle:function(e){let{id:t,sourceX:r,sourceY:o,targetX:l,targetY:i,label:a,data:n,markerEnd:d,style:c}=e,[p,h,u]=(0,g.ah)({sourceX:r,sourceY:o,targetX:l,targetY:i}),b=180/Math.PI*Math.atan2(i-o,l-r);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(g.tE,{id:t,path:p,markerEnd:d,style:c}),!(null==n?void 0:n.bidirectionnel)&&(0,s.jsx)(g.rV,{children:(0,s.jsx)("div",{className:"w-0 h-0 border-t-6 border-b-6 border-l-10 border-transparent border-l-black",style:{position:"absolute",left:(r+l)/2,top:(o+i)/2,transform:"translate(-50%, -50%) rotate(".concat(b,"deg)"),transformOrigin:"center",color:"#000"}})}),(null==n?void 0:n.hover)&&a&&(0,s.jsx)(g.rV,{children:(0,s.jsx)("div",{className:"bg-gray-800 p-1 border border-gray-600 shadow-lg text-sm rounded-md z-10 absolute",style:{transform:"translate(-50%, -50%)",left:h,top:u},children:a})})]})}};function m(e){let{articles:t,slugCentral:r="",className:d="",height:c="700px",avecFiltres:m=!0}=e,[j,w,v]=(0,g.ck)([]),[N,C,k]=(0,g.fM)([]),[A,E]=(0,p.useState)(new Set),[M,D]=(0,p.useState)(!0);(0,p.useEffect)(()=>{D(!0);let{nodes:e,edges:s}=function(e,t,r){let s=e.filter(e=>!r||0===r.size||r.has(e.categorie)),d=s.map(e=>({id:e.slug,label:e.titre,categorie:e.categorie,estCentre:e.slug===t,x:void 0,y:void 0})),c=[];s.forEach(e=>{e.relations&&e.relations.explicit&&e.relations.explicit.forEach(t=>{s.find(e=>e.slug===t.slug)&&(c.push({id:"".concat(e.slug,"--").concat(t.slug,"--").concat(t.type),source:e.slug,target:t.slug,typeRelation:t.type,force:t.force||1,label:t.type,description:t.description,bidirectionnel:!1}),t.bidirectionnel&&c.push({id:"".concat(t.slug,"--").concat(e.slug,"--").concat(t.type),source:t.slug,target:e.slug,typeRelation:t.type,label:t.type,bidirectionnel:!0}))})});let p=c.map(e=>({source:e.source,target:e.target,force:e.force||1,id:e.id,typeRelation:e.typeRelation,description:e.description,label:e.label})),g=(0,o.A)(d);g.force("link",(0,l.A)(p).id(e=>e.id).distance(e=>100/(e.force||1)).strength(.7)),g.force("charge",(0,i.A)().strength(-40)),g.force("center",(0,a.A)(0,0)),g.force("collide",(0,n.A)(75).strength(.7)),g.stop();for(let e=0;e<300;++e)g.tick();return{nodes:d.map(e=>({id:e.id,type:"noeudArticle",position:{x:e.x||0,y:e.y||0},data:{slug:e.id,titre:e.label,categorie:e.categorie,estCentre:e.estCentre}})),edges:c.map(e=>({id:e.id,source:e.source,target:e.target,type:"areteArticle",label:e.label,data:{typeRelation:e.typeRelation,description:e.description,bidirectionnel:e.bidirectionnel||!1,hover:!1},style:{stroke:"#374151",strokeWidth:Math.max(1.5*(e.force||1),2)}}))}}(t,r,A);w(e),C(s),D(!1)},[t,r,A]);let R=(0,p.useCallback)((e,t)=>{let r=j.filter(e=>e.id!==t.id),s=[];r.forEach(e=>{let r=t.position.x-e.position.x,o=t.position.y-e.position.y,l=Math.sqrt(r*r+o*o);if(l<110.00000000000001&&l>0){let t=(110.00000000000001-l)/110.00000000000001;s.push({...e,position:{x:e.position.x-r/l*t*30,y:e.position.y-o/l*t*30}})}}),s.length>0&&w(e=>e.map(e=>s.find(t=>t.id===e.id)||e))},[j,w]),S=(0,p.useCallback)((e,t)=>{C(r=>r.map(r=>r.id===e?{...r,data:{...r.data,hover:t}}:r))},[C]),V=(0,p.useCallback)((e,t)=>{S(t.id,!0)},[S]),z=(0,p.useCallback)((e,t)=>{S(t.id,!1)},[S]),T=Array.from(new Set(t.map(e=>e.categorie))),Z={nombreNoeuds:j.length,nombreAretes:N.length};return(0,s.jsx)("div",{className:"border border-gray-300 rounded-lg overflow-hidden bg-gray-200 "+d,style:{height:c},children:(0,s.jsx)("div",{className:"relative w-full h-full",style:{width:"100%",height:"100%"},children:(0,s.jsxs)(g.Gc,{nodes:j,edges:N,onNodeDrag:R,fitView:!0,fitViewOptions:{padding:.2,includeHiddenNodes:!1,minZoom:.5,maxZoom:1.5},nodeTypes:x,edgeTypes:y,onNodesChange:v,onEdgesChange:k,onEdgeMouseEnter:V,onEdgeMouseLeave:z,attributionPosition:"bottom-right",children:[(0,s.jsx)(h.V,{color:"#f0f0f0"}),(0,s.jsx)(u.H,{position:"top-left"}),(0,s.jsx)(b.o,{nodeColor:e=>f[e.data.categorie]||f.Defaut,maskColor:"rgba(f,f,f,0.3)"}),m&&(0,s.jsxs)(g.Zk,{position:"top-right",className:"bg-gray-800 p-4 rounded-lg shadow-lg border border-gray-300/80 text-white",children:[(0,s.jsx)("h3",{className:"font-bold mb-3 text-sm",children:"Filtrer par cat\xe9gorie"}),(0,s.jsx)("div",{className:"space-y-2",children:T.map(e=>(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm text-gray-100",children:[(0,s.jsx)("input",{type:"checkbox",checked:0===A.size||A.has(e),onChange:()=>(e=>{let t=new Set(A);t.has(e)?t.delete(e):t.add(e),E(t)})(e),className:"rounded"}),(0,s.jsx)("span",{className:"w-3 h-3 rounded-full",style:{backgroundColor:f[e]||f.Defaut}}),(0,s.jsx)("span",{children:e})]},e))}),(0,s.jsx)("button",{onClick:()=>{E(new Set)},className:"mt-4 w-full px-3 py-2 bg-blue-600 text-white text-sm rounded hover:bg-blue-700",children:"Afficher tout"}),M&&(0,s.jsx)("div",{className:"mt-4 text-sm text-gray-400",children:"Calcul du graphe..."})]}),(0,s.jsx)(g.Zk,{position:"bottom-left",className:"bg-slate-800 p-3 rounded-lg shadow-lg border border-slate-300/80 text-white",children:(0,s.jsxs)("div",{className:"text-xs text-gray-300 space-y-1",children:[Z.nombreNoeuds," articles, ",Z.nombreAretes," connexions"]})})]})})})}}}]);